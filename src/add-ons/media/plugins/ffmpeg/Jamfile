SubDir HAIKU_TOP src add-ons media plugins ffmpeg ;

SetSubDirSupportedPlatformsBeOSCompatible ;

UsePrivateHeaders media shared ;

SubDirC++Flags -D__STDC_CONSTANT_MACROS -Wno-deprecated-declarations ;

local sources =
	AVCodecDecoder.cpp
	AVCodecEncoder.cpp
	AVFormatReader.cpp
	AVFormatWriter.cpp
	CodecTable.cpp
	DemuxerTable.cpp
	EncoderTable.cpp
	FFmpegPlugin.cpp
	MuxerTable.cpp
	CpuCapabilities.cpp
	
	gfx_conv_c.cpp
	gfx_conv_c_lookup.cpp
	gfx_conv_mmx.cpp
	gfx_util.cpp
	;


UseBuildFeatureHeaders ffmpeg ;
Includes [ FGristFiles $(sources) ]
	: [ BuildFeatureAttribute ffmpeg : headers ] ;

local ffmpegHeaders = [ BuildFeatureAttribute ffmpeg : headers : path ] ;
UseHeaders $(ffmpegHeaders) ;
UseHeaders [ FDirName $(ffmpegHeaders) libavcodec ] ;
UseHeaders [ FDirName $(ffmpegHeaders) libavdevice ] ;
UseHeaders [ FDirName $(ffmpegHeaders) libavfilter ] ;
UseHeaders [ FDirName $(ffmpegHeaders) libavformat ] ;
UseHeaders [ FDirName $(ffmpegHeaders) libavutil ] ;
UseHeaders [ FDirName $(ffmpegHeaders) libswscale ] ;

Addon ffmpeg :
	$(sources)

	yuvrgb_sse.nasm
	yuvrgb_sse2.nasm
	yuvrgb_ssse3.nasm
	:

	# FFmpeg libraries (from FFmpeg optional package):
	[ BuildFeatureAttribute ffmpeg : libraries ]

	[ BuildFeatureAttribute speex : libraries ]
	[ BuildFeatureAttribute libtheora : libraries ]
	[ BuildFeatureAttribute libvorbis : libraries ]
	[ BuildFeatureAttribute libogg : libraries ]
	[ BuildFeatureAttribute libvpx : libraries ]
	libbz2_ffmpeg.a

	be
	media
	[ BuildFeatureAttribute zlib : library ]
	$(TARGET_LIBSUPC++)
	$(TARGET_NETWORK_LIBS)
;

SubInclude HAIKU_TOP src add-ons media plugins ffmpeg libbz2 ;

