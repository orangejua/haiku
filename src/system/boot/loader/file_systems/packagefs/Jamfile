SubDir HAIKU_TOP src system boot loader file_systems packagefs ;

UsePrivateHeaders [ FDirName kernel boot platform $(TARGET_BOOT_PLATFORM) ] ;
UsePrivateHeaders kernel shared ;
UseBuildFeatureHeaders zlib ;

DEFINES += _BOOT_MODE ;

local kernelC++Header = [ FDirName $(HAIKU_TOP) headers private kernel util
	kernel_cpp.h ] ;

SubDirC++Flags -fno-rtti -include $(kernelC++Header) ;

SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src kits package ] ;
SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src kits package hpkg ] ;


BootStaticLibrary boot_packagefs :
	packagefs.cpp

	# package kit

	# package kit/hpkg
	BlockBufferPool.cpp
	BlockBufferPoolImpl.cpp
	BlockBufferPoolNoLock.cpp
	BufferPool.cpp
	PoolBuffer.cpp
	DataOutput.cpp
	DataReader.cpp
	ErrorOutput.cpp
	FDDataReader.cpp
	PackageContentHandler.cpp
	PackageData.cpp
	PackageDataReader.cpp
	PackageEntry.cpp
	PackageEntryAttribute.cpp
	PackageFileHeapAccessorBase.cpp
	PackageFileHeapReader.cpp
	PackageReaderImpl.cpp
	ReaderImplBase.cpp

	# compression
	ZlibCompressionBase.cpp
	ZlibDecompressor.cpp

	: -fno-pic
;

Includes [
		FGristFiles ZlibCompressionBase.cpp package/hpkg/ZlibCompressor.h
		package/hpkg/ZlibDecompressor.h
	]
	: [ BuildFeatureAttribute zlib : headers ] ;

